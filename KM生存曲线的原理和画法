KM法即乘积极限法（product-limit method），是现在生存分析最常用的方法，是由Kaplan和Meier于1958年提出，因此称Kaplan-Meier法，通常简称KM法。KM法是这样估计生存曲线：首先计算出活过一定时期的病人再活过下一时期的概率（即生存概率），然后将逐个生存概率相乘，即为相应时段的生存率。

讲原理前，先同步几个概念：

（1）观察终点/评价指标：生存分析，并不一定是要对所有观察对象一直保持终生关注（观察时间太长了，难以实现），所以往往会人为设置观察终点——可能是以时间为条件，例如5年生存期；也可能以事件为条件，例如疾病复发。拓展内容：肿瘤临床试验终点和评价指标

（2）结局事件：结局事件，在观察试验开始前是需要明确给出定义的，当然，也取决于观察终点。举例来说，5年生存期作为观察终点的结局事件是“死亡”，对应的没有发生结局事件的状态被声明为“生存”。疾病复发作为观察终点的解决事件是“复发”，对应的没有发生的状态为“未复发”。

（3）删失：现实中，不是所有数据都能够被记录到的，总是有患者在观察终点前失去联系了，可能换了联系方式，或者退出了试验。那么这些参与了观察，但是“半途而废”的数据，将被标注为“删失”。一方面确实产生了有效的观察记录，一方面要声明这个患者的数据的观察周期是不完整的。

（4）观察/对照组：生存分析往往是为了证明/反驳生存和某个观察变量条件的相关性，例如是否有暴露史、检测指标高低，等等。基于观察变量形成两个队列分组，这两个队列的结果往往要分开作图，查看是否形成区分度。

接下来，讲原理。

原理很简单——要解决的问题是在某个时间点上，生存的可能性是多大。KM给出的方法，不是基于某个分布来产生概率估计的计算值，而是采用简单粗暴的方式，直接基于观察样本的统计值给出结果。

生存率(Survival rate)，用S(tk)S(tk)表示，指经历tktk个单位时间后仍存活的概率，若无删失数据，则为活过了tktk时刻仍然存活的例数/观察开始的总例数。如果有删失数据，分母则需要按时段进行校正，此时生存率的计算公式为

S(tk)=P(T>tk)=p1⋅p2⋅⋅⋅pk

某个时间点上的生存率=上一个时间点的存活率*（当前时间有多少人确实存活/当前时间有多少人可能还活着）=上一个时间点的存活率*（当前时间存活人数/（当前时间存活人数+删失人数））

举例来说明，会很好理解。

假设有 100 名患者，发生终点事件和删失数据如下，其累积生存率这样算：


画法：

（1）在每个发生死亡事件的时间点上，进行生存率的计算

（2）在每个发生删失的时间点上，画小竖线标记删失样本

（3）根据观察/对照条件分组作图

示例如下：


示例数据

id	month	censor	dead	factor
1	6	0	1	0
2	6	0	1	0
3	6	0	1	0
4	6	0	1	0
5	6	0	1	0
6	7	0	1	0
7	7	0	1	1
8	7	0	1	1
9	7	0	1	1
10	10	0	1	1
11	10	0	1	1
12	10	0	1	1
13	10	0	1	0
14	10	0	1	0
15	10	0	1	0
16	10	0	1	0
17	10	0	1	0
18	13	0	1	0
19	13	0	1	1
20	13	0	1	1
21	13	0	1	1
22	13	0	1	1
23	13	0	1	1
24	16	0	1	1
25	16	0	1	0
26	22	0	1	0
27	22	0	1	0
28	22	0	1	0
29	22	0	1	0
30	22	0	1	0
31	22	0	1	1
32	22	0	1	1
33	22	0	1	1
34	22	0	1	1
35	22	0	1	1
36	23	0	1	1
37	23	0	1	0
38	23	0	1	0
39	23	0	1	0
40	23	0	1	0
41	23	0	1	0
42	23	0	1	0
43	23	0	1	1
44	25	0	1	1
45	26	0	1	1
46	27	0	1	1
47	28	0	1	1
48	4	1	0	1
49	6	1	0	0
50	7	1	0	0
51	7	1	0	0
52	7	1	0	0
53	8	1	0	0
54	9	1	0	0
55	11	1	0	1
56	11	1	0	1
57	13	1	0	1
58	13	1	0	1
59	13	1	0	1
60	14	1	0	1
61	15	1	0	0
62	16	1	0	0
63	17	1	0	0
64	17	1	0	0
65	20	1	0	0
66	20	1	0	0
67	21	1	0	1
68	23	1	0	1
69	23	1	0	1
70	23	1	0	1
71	23	1	0	1
72	23	1	0	1
73	25	1	0	0
74	25	1	0	0
75	25	1	0	0
76	30	0	0	0
77	30	0	0	0
78	30	0	0	0
79	30	0	0	1
80	30	0	0	1
81	30	0	0	1
82	30	0	0	1
83	30	0	0	1
84	30	0	0	1
85	30	0	0	0
86	30	0	0	0
87	30	0	0	0
88	30	0	0	0
89	30	0	0	0
90	30	0	0	0
91	30	0	0	1
92	30	0	0	1
93	30	0	0	1
94	30	0	0	1
95	30	0	0	1
96	30	0	0	1
97	30	0	0	0
98	30	0	0	0
99	30	0	0	1
100	30	0	0	1
